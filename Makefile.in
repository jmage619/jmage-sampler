CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@

#CXXFLAGS := -Wall -O3
CXXFLAGS := @CXXFLAGS@
#LIB = -ljack -framework CoreAudio
LIB = -lm -ljack -lsndfile -lsamplerate
CXX = g++
CC = gcc

#all : test_sampler
all : libjm_sampler.so jm-sampler-lv2.so jm-sampler-lv2ui.so

test_sampler : test_sampler.o libjm_sampler.so
	$(CXX) $(LIB) $(LDFLAGS) -L. -ljm_sampler -o $@ $<

test_sampler.o: src/test_sampler.c src/jmage/sampler.h
	gcc -Wall -g -Isrc -c -o $@ $<

jm-sampler-lv2ui.so: jm-sampler-lv2ui.o
	$(CC) $(LIB) $(LDFLAGS) -shared -o $@ $^

jm-sampler-lv2ui.o: src/jm-sampler-lv2ui.c src/uris.h
	$(CC) $(CXXFLAGS) $(CPPFLAGS) -fPIC -Isrc -c -o $@ $<

jm-sampler-lv2.so: jm-sampler-lv2.o sampler.o components.o jmsampler.o
	$(CXX) $(LIB) $(LDFLAGS) -shared -o $@ $^

jm-sampler-lv2.o: src/jm-sampler-lv2.cpp src/uris.h
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -fPIC -Isrc -c -o $@ $<

libjm_sampler.so: sampler.o jmzonelist.o components.o jmsampler.o
	$(CXX) $(LIB) $(LDFLAGS) -shared -o $@ $^

jmzonelist.o : src/jmage/jmzonelist.cxx src/jmage/jmzonelist.h src/jmage/sampler.h
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -fPIC -Isrc -c -o $@ $<

jmsampler.o : src/jmage/jmsampler.cxx src/jmage/jmsampler.h src/jmage/sampler.h \
src/jmage/components.h src/jmage/collections.h
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -fPIC -Isrc -c -o $@ $<

sampler.o : src/jmage/sampler.cxx src/jmage/sampler.h src/jmage/collections.h
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -fPIC -Isrc -c -o $@ $<

components.o : src/jmage/components.cxx src/jmage/components.h src/jmage/collections.h
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -fPIC -Isrc -c -o $@ $<

clean:
	rm -f test_sampler test_sampler.o jm-sampler-lv2.so jm-sampler-lv2ui.so libjm_sampler.so jm-sampler-lv2.o jm-sampler-lv2ui.o jmzonelist.o jmsampler.o sampler.o components.o python/jmage/*.pyc 
